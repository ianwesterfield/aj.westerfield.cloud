{
  "category": "shutdown_target_selection",
  "description": "Shutdown/restart target disambiguation and confirmation patterns. These trajectories train the agent to safely handle destructive operations by discovering available agents, disambiguating targets, asking clarifying questions, and confirming before execution.",
  "tags": [
    "destructive_operation",
    "agent_discovery",
    "target_disambiguation",
    "confirmation_pattern",
    "safety_critical"
  ],
  "difficulty_levels": {
    "easy": "Explicit target names with clear match to available agents (3 prompts)",
    "medium": "Ambiguous targets requiring clarification or contextual reasoning (8 prompts)",
    "hard": "Error recovery, confirmation patterns, guardrail enforcement (9 prompts)"
  },
  "guardrail_types": [
    "ambiguous_target",
    "self_target_warning",
    "ambiguous_target_recovery",
    "destructive_op_error_recovery",
    "bulk_destructive_op",
    "critical_service_warning",
    "rolling_operation",
    "ambiguous_target_block"
  ],
  "prompt_categories": {
    "explicit_target": {
      "description": "User explicitly names the target machine",
      "example_prompts": [
        "Shutdown the machine named 'domain02'",
        "Restart the server 'production-db'",
        "Gracefully shutdown 'ians-r16'"
      ],
      "expected_behavior": [
        "Identify target by exact name match",
        "Confirm with user that correct machine was selected",
        "Warn if target is user's own workstation or running critical services",
        "Execute after confirmation"
      ]
    },
    "ambiguous_singular": {
      "description": "User uses singular form that could match multiple agents",
      "example_prompts": [
        "Shutdown the server",
        "Restart the workstation",
        "Turn off the database machine",
        "Shutdown the primary node"
      ],
      "expected_behavior": [
        "Discover all available agents",
        "Filter by description (server, workstation, database, node, etc.)",
        "If multiple matches: List all candidates with metadata",
        "Ask user to clarify which specific machine",
        "Only execute after explicit confirmation"
      ]
    },
    "contextual_clues": {
      "description": "User provides contextual hints (env, role, ownership) to disambiguate",
      "example_prompts": [
        "Shutdown the production server",
        "Restart my workstation",
        "Shutdown the backup node",
        "Turn off the Windows machine"
      ],
      "expected_behavior": [
        "Use metadata (hostname patterns, platform, tags, current_task) to narrow candidates",
        "Resolve 'my' to user's own machine from context",
        "Filter by environment prefix (prod-, staging-, dev-)",
        "Filter by platform (Windows vs Linux)",
        "If still ambiguous after filtering, ask for clarification"
      ]
    },
    "error_recovery": {
      "description": "User's clarification is still ambiguous or agent makes a mistake",
      "example_prompts": [
        "User says 'shutdown the server' → agent lists candidates → user clarifies 'the OTHER prod one' → still ambiguous",
        "User says 'shutdown domain02' → agent can't find exact match → suggests similar names",
        "Agent mistakenly shuts down wrong machine → user says STOP"
      ],
      "expected_behavior": [
        "For ambiguous clarifications: Ask for more specific identifiers (IP, hostname suffix, port, workspace)",
        "For not-found: Use fuzzy matching, suggest similar names, ask for confirmation",
        "For error recovery: Immediately attempt to restore, provide rollback instructions, escalate to user"
      ]
    },
    "confirmation_pattern": {
      "description": "Multi-step or high-risk scenarios requiring explicit per-step approval",
      "example_prompts": [
        "Shutdown ALL agents that match pattern 'prod-*' (5 machines)",
        "Restart the machine '192.168.1.5' (given IP address)",
        "Shutdown the orchestrator node while only one worker backup exists"
      ],
      "expected_behavior": [
        "For bulk operations: List each machine, require explicit yes/no per machine or bulk approval phrase",
        "For IP resolution: Map IP to hostname, show current state (uptime, workload), confirm impact",
        "For critical services: Warn about cascading effects, require confirmation, show impact on availability",
        "Show clear before/after state for validation"
      ]
    },
    "multi_agent_coordination": {
      "description": "Ordered sequences of operations across multiple machines",
      "example_prompts": [
        "Rolling shutdown of cluster: shutdown node-1, wait, shutdown node-2, wait, restart node-1",
        "Shutdown all agents except the one running the user's IDE (ians-r16)"
      ],
      "expected_behavior": [
        "Create explicit ordered sequence with dependencies",
        "Confirm before each step",
        "Show service impact after each step",
        "Filter out protected machines (user's own workstation)",
        "Require bulk approval or per-step approval"
      ]
    },
    "guardrail_enforcement": {
      "description": "Scenarios where guardrails should BLOCK execution",
      "example_prompts": [
        "Shutdown 'server' with NO additional context (matches 3 different prod agents)"
      ],
      "expected_behavior": [
        "Trigger ambiguous_target guardrail",
        "REFUSE to execute",
        "List all matching candidates",
        "Require user to pick one explicitly",
        "Never guess or use default selection"
      ]
    }
  },
  "training_distribution": {
    "total_prompts": 20,
    "by_difficulty": {
      "easy": 3,
      "medium": 8,
      "hard": 9
    },
    "by_category": {
      "explicit_target": 3,
      "ambiguous_singular": 4,
      "contextual_clues": 4,
      "error_recovery": 3,
      "confirmation_pattern": 3,
      "multi_agent_coordination": 2,
      "guardrail_enforcement": 1
    }
  },
  "safety_principles": [
    "ALWAYS discover available agents before executing shutdown/restart",
    "If target is ambiguous (matches >1 agent), ask for clarification - NEVER guess",
    "Warn if target is user's own active machine or running critical services",
    "For bulk operations (>1 machine), require explicit per-machine or bulk confirmation",
    "Show agent metadata (hostname, platform, current_task) to help user identify correct machine",
    "Implement three-tier confirmation: ambiguous_target guard → user clarification → final confirmation",
    "Log all confirmations and show them to user for validation",
    "On error (wrong machine selected), provide immediate rollback/recovery options"
  ],
  "expected_model_behaviors_after_training": [
    "Recognizes destructive operations and triggers discovery flow",
    "Interprets user requests in context of available agents",
    "Asks clarifying questions that help disambiguate (e.g., 'Is this the prod server or staging?')",
    "Confirms targets before execution with clear machine identification",
    "Handles multi-step operations with ordered confirmation",
    "Triggers ambiguous_target guardrail when appropriate",
    "Avoids selecting wrong target even when ambiguity exists",
    "Provides recovery paths when mistakes occur",
    "Balances user intent with safety constraints"
  ],
  "related_schemas": [
    "training/agentic/schemas/trajectories.json",
    "training/agentic/schemas/guardrails.json"
  ],
  "generation_command": "python generate_trajectories.py --category shutdown --use-claude --output ../data/"
}